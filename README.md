# nginx-upstream
docker+nginx+node 负载均衡

docker network create compose_default
docker-compose up --scale web=5 

# 查看容器的ip:

docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' container_name_or_id

172.19.0.7
172.19.0.6
172.19.0.5
172.19.0.4
172.19.0.3
172.19.0.2

# 测试
curl -I 127.0.0.1:4000　# 这个端口号是之前在yml文件中定义在nginx下面的ports里面的
多运行几次,然后打开nginx目录下的access.log文件,可以看到如下信息:

172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.2:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.4:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.5:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.3:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.6:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.2:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.4:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.5:3000"
172.19.0.1 - -[11/Nov/2016:17:12:40 +0000] "curl/7.29.0" "-" "172.19.0.3:3000"
172.19.0.1 - -[11/Nov/2016:17:12:41 +0000] "curl/7.29.0" "-" "172.19.0.6:3000"
172.19.0.1 - -[11/Nov/2016:17:12:41 +0000] "curl/7.29.0" "-" "172.19.0.2:3000"

看最后一列的172.19.0.2:3000这样的地址,是我们具体容器的ip,每次请求nginx都会根据算法来调度,所以这些地址会变化,说明部署成功.
